import { Callout, FileTree } from 'nextra/components';

# Customizing Output

Output can be customized following an adapted version of TypeDoc's [Custom Theme docs](https://github.com/TypeStrong/typedoc/blob/master/internal-docs/custom-themes.md).

Additional functionality is provided by writing a local plugin.

<Callout type="warning">
  Examples in this guide are written as ESM, however TypeDoc supports both ESM
  and CommonJS modules. Please adapt to your own coding preference.
</Callout>

## Writing a Local plugins

To get started a create a local TypeDoc plugin file. Here we are writing a file in a directory named `local-plugins` and referencing it in `typedoc.json`.

```js filename="local-plugins/my-custom-plugin.mjs"
// @ts-check

/**
 * @param {import('typedoc-plugin-markdown').MarkdownApplication} app
 */
export function load(app) {
  // Additional customization should be placed in the load function.
}
```

The file can the be referenced in the `typedoc.json` file.

```json filename="typedoc.json"
{
  "plugin": ["typedoc-plugin-markdown", "./local-plugins/my-custom-plugin.mjs"]
}
```

## Consuming Navigtion

If required a navigation structure can be provided to the output. This is useful if you want to provide a custom sidebar or navigation bar.

This can be achieved by adding `postRenderAsyncJobs` to the renderer.

```js filename="local-plugins/my-navigation-plugin.mjs"
// @ts-check

/**
 * @param {import('typedoc-plugin-markdown').MarkdownApplication} app
 */
export function load(app) {
  app.renderer.postRenderAsyncJobs.push(
   /**
    * @param {import('typedoc-plugin-markdown').MarkdownRendererEvent} output
    */
    async (event: MarkdownRendererEvent) => {
      // The navigation JSON structure is available on the output.
      const navigation = event.navigation;

      // This can be parsed to something else or written straight to a file:
      fs.writeFileSync('navigation.json', JSON.stringify(navigation));
    },
  );
}
```

## Utilizing Hooks

Hooks allows Markdown (or HTML) to be injected into the output in specific locations and are the most basic form form of customization.

```js filename="local-plugins/custom-plugin.mjs"
// @ts-check

/**
 * @param {import('typedoc-plugin-markdown').MarkdownApplication} app
 */
export function load(app) {
  // Add a hook to insert markdown at the top of the page.
  app.renderer.markdownHooks.on(
    'page.begin',
    () => '> This is some markdown at the top of the page',
  );
}
```

Available hooks are:

- `page.begin` - Applied at the start of the markdown output.
- `page.end` - Applied at the end of the markdown output.
- `content.begin` - Applied before the main markdown content is rendered..

## Writing a Custom Theme

If there are some specific customization not achievable with hooks then a more advanced customization can be achieved by providing a new theme class which returns a different context class.

In theory all available templates, partials and helpers can be overriden with custom implementations, but please proceed with caution.

Please consider raising a PR to the plugin directly if you think your customizations would be useful to others.

```js filename="custom-plugin.mjs"
// @ts-check

/**
 * @param {import('typedoc-plugin-markdown').MarkdownApplication} app
 */
export function load(app) {
  // Add a hook to insert markdown at the top of the page.
  app.renderer.defineTheme('custom-theme', MyMarkdownTheme);
}

class MyMarkdownTheme extends MarkdownTheme {
  /**
   * @param {import('typedoc-plugin-markdown').MarkdownPageEvent} page
   */
  getRenderContext(page) {
    return new MyMarkdownThemeRenderContext(
      this,
      page,
      this.application.options,
    );
  }
}

class MyMarkdownThemeRenderContext extends MarkdownThemeRenderContext {
  partials = {
    ...this.partials,
    /**
     * @param {import('typedoc-plugin-markdown').MarkdownPageEvent} page
     */
    header: (page) => {
      return `Welcome to ${page.project.name} custom header!`;
    },
  };
}
```
